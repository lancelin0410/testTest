import{a9 as L,l as N,ab as T,r as h,m as S,X as U,aH as D,j as f,w as r,u as t,D as W,d as P,z as A,f as e,H as c,ad as u,J as g,aJ as b,aK as y,a1 as v,h as C,y as k,v as _,B as x,M as H,A as J,t as w,ae as M,aT as j}from"./index-BWYPlUKf.js";import{f as q,h as z}from"./withdraw-2q59VMUi.js";const E={slot:"start"},G=C("span",{slot:"start"},"OTP",-1),Q={__name:"WithdrawPassword",setup(K){const{t:d}=L(),O=W(),l=N(),a=T({withdrawPasswordOri:"",withdrawPassword:"",withdrawPasswordRepeat:"",mobile:"",code:"",sessionId:""});let I;const V=Number(l.appConfig.callPrefixes),i=h(0),p=h(d("account.button.otp")),m=h(!1);S(()=>!!a.mobile),U(async()=>{l.barLoading=!0;const s=await D();s.code==="00000"&&(m.value=!!s.data.withdrawPasswordValid),l.barLoading=!1});const R=async()=>{if(i.value==0){if(!a.mobile||a.mobile.length==0){await(await w.create({message:d("account.withdrawalPassword.toast.phone"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}const s=await M({mobile:l.encrypt.encrypt(a.mobile),callPrefixes:V});s.code==="00000"&&(a.sessionId=s.data.sessionId,i.value=60,B())}},B=()=>{p.value="".concat(i.value,"s"),I=setInterval(()=>{i.value>0?(i.value--,p.value="".concat(i.value,"s")):(p.value=d("account.button.otp"),i.value=0,clearInterval(I))},1e3)},$=async()=>{if(m.value&&(!a.withdrawPasswordOri||a.withdrawPasswordOri.length==0)){await(await w.create({message:d("account.withdrawalPassword.toast.withdrawPasswdOri"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!a.withdrawPassword||a.withdrawPassword.length==0){await(await w.create({message:d("account.withdrawalPassword.toast.withdrawPasswd"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(a.withdrawPassword!==a.withdrawPasswordRepeat){await(await w.create({message:d("account.withdrawalPassword.toast.withdrawPasswdRepeat"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!a.mobile||a.mobile.length==0){await(await w.create({message:d("account.withdrawalPassword.toast.phone"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!a.code||a.code.length==0){await(await w.create({message:d("account.withdrawalPassword.toast.verificationCode"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}l.fullLoading=!0;let s;m.value?s=await q({oldPassword:l.encrypt.encrypt(a.withdrawPasswordOri),password:l.encrypt.encrypt(a.withdrawPassword),confirmPassword:l.encrypt.encrypt(a.withdrawPasswordRepeat),code:a.code,sessionId:a.sessionId}):s=await z({password:l.encrypt.encrypt(a.withdrawPassword),confirmPassword:l.encrypt.encrypt(a.withdrawPasswordRepeat),code:a.code,sessionId:a.sessionId}),s.code==="00000"&&(await(await w.create({message:"Success",duration:1500,position:"top",translucent:!0,icon:j,color:"success"})).present(),setTimeout(()=>O.back(),1e3)),l.fullLoading=!1};return(s,o)=>(P(),f(t(J),{class:"withdraw-password"},{default:r(()=>[t(l).barLoading?v("",!0):(P(),f(t(A),{key:0},{default:r(()=>[e(t(H),{lines:"none"},{default:r(()=>[m.value?(P(),f(t(c),{key:0,style:{margin:"32px 0"}},{default:r(()=>[e(t(u),{modelValue:a.withdrawPasswordOri,"onUpdate:modelValue":o[0]||(o[0]=n=>a.withdrawPasswordOri=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.originalPassword")},{default:r(()=>[e(t(g),{slot:"start",icon:t(b)},null,8,["icon"]),e(t(y),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1})):v("",!0),e(t(c),{style:{margin:"8px 0"}},{default:r(()=>[e(t(u),{modelValue:a.withdrawPassword,"onUpdate:modelValue":o[1]||(o[1]=n=>a.withdrawPassword=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.password")},{default:r(()=>[e(t(g),{slot:"start",icon:t(b)},null,8,["icon"]),e(t(y),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1}),e(t(c),{style:{margin:"8px 0 16px 0"}},{default:r(()=>[e(t(u),{modelValue:a.withdrawPasswordRepeat,"onUpdate:modelValue":o[2]||(o[2]=n=>a.withdrawPasswordRepeat=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.repeatPassword")},{default:r(()=>[e(t(g),{slot:"start",icon:t(b)},null,8,["icon"]),e(t(y),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1}),e(t(c),{style:{margin:"16px 0 8px 0"}},{default:r(()=>[e(t(u),{modelValue:a.mobile,"onUpdate:modelValue":o[3]||(o[3]=n=>a.mobile=n),fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.phone")},{default:r(()=>[C("span",E,"+"+k(t(V)),1)]),_:1},8,["modelValue","placeholder"])]),_:1}),e(t(c),{style:{margin:"8px 0"}},{default:r(()=>[e(t(u),{modelValue:a.code,"onUpdate:modelValue":o[4]||(o[4]=n=>a.code=n),fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.otpPlaceholder")},{default:r(()=>[G,e(t(_),{slot:"end",class:"btn-otp",color:"medium",style:{color:"#00ff84"},onClick:R},{default:r(()=>[x(k(p.value),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1}),e(t(_),{class:"btn-confirm",expand:"block",shape:"round",onClick:$},{default:r(()=>[x("Confirm")]),_:1})]),_:1}))]),_:1}))}};export{Q as default};
