import{k as $,r as h,J as v,K as r,G as a,I as V,b as D,V as L,D as e,U as S,M as _,N as k,P as x}from"./@vue-DQPB5ixA.js";import{u as U}from"./vue-i18n-D3aLYNeJ.js";import{o as T,u as W,C as G,D as c,J as u,e as P,P as g,f as C,n as J,j as M,t as w}from"./@ionic-BzoWLFGj.js";import{n as b,x as j}from"./ionicons-DKP7Q_k0.js";import{u as q,m as A,h as E}from"./index-BakalulC.js";import{f as K,h as z}from"./withdraw-DaNfble3.js";import"./@intlify-BAcCFw_v.js";import"./@ionic_components_1-CAQXnsIn.js";import"./@stencil-C-gE1UvY.js";import"./@ionic_components_2-DUGZJZYA.js";import"./@capacitor-CHoHO2YB.js";import"./vue-router-CQQ818li.js";import"./localforage-qzmIiYbH.js";import"./@adjustcom-Dev-Q0DI.js";import"./pinia-CYwfShO_.js";import"./jsencrypt-Ve0Y4aUG.js";import"./pinia-plugin-persistedstate-2-DcGv4gw_.js";import"./@awesome-cordova-plugins-CT7d7gQP.js";import"./rxjs-C3tg6S9t.js";import"./tslib-BHBn2Msb.js";const F={slot:"start"},H=_("span",{slot:"start"},"OTP",-1),Pt={__name:"WithdrawPassword",setup(Q){const{t:i}=U(),O=W(),l=q(),t=$({withdrawPasswordOri:"",withdrawPassword:"",withdrawPasswordRepeat:"",mobile:"",code:"",sessionId:""});let y;const I=Number(l.appConfig.callPrefixes),d=h(0),p=h(i("account.button.otp")),m=h(!1),f=h(!1);T(async()=>{l.barLoading=!0;const s=await A();s.code==="00000"&&(m.value=!!s.data.withdrawPasswordValid,f.value=!!s.data.phoneValid),l.barLoading=!1});const R=async()=>{if(d.value==0){if(!t.mobile||t.mobile.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.phone"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}const s=await E({mobile:l.encrypt.encrypt(t.mobile),callPrefixes:I});s.code==="00000"&&(t.sessionId=s.data.sessionId,d.value=60,B())}},B=()=>{p.value="".concat(d.value,"s"),y=setInterval(()=>{d.value>0?(d.value--,p.value="".concat(d.value,"s")):(p.value=i("account.button.otp"),d.value=0,clearInterval(y))},1e3)},N=async()=>{if(m.value&&(!t.withdrawPasswordOri||t.withdrawPasswordOri.length==0)){await(await w.create({message:i("account.withdrawalPassword.toast.withdrawPasswdOri"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!t.withdrawPassword||t.withdrawPassword.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.withdrawPasswd"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(t.withdrawPassword!==t.withdrawPasswordRepeat){await(await w.create({message:i("account.withdrawalPassword.toast.withdrawPasswdRepeat"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!t.mobile||t.mobile.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.phone"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!t.code||t.code.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.verificationCode"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}l.fullLoading=!0;let s;m.value?s=await K({oldPassword:l.encrypt.encrypt(t.withdrawPasswordOri),password:l.encrypt.encrypt(t.withdrawPassword),confirmPassword:l.encrypt.encrypt(t.withdrawPasswordRepeat),mobile:f.value?"":l.encrypt.encrypt(t.mobile),code:t.code,sessionId:t.sessionId}):s=await z({password:l.encrypt.encrypt(t.withdrawPassword),confirmPassword:l.encrypt.encrypt(t.withdrawPasswordRepeat),mobile:f.value?"":l.encrypt.encrypt(t.mobile),code:t.code,sessionId:t.sessionId}),s.code==="00000"&&(await(await w.create({message:"Success",duration:1500,position:"top",translucent:!0,icon:j,color:"success"})).present(),setTimeout(()=>O.back(),1e3)),l.fullLoading=!1};return(s,o)=>(V(),v(a(M),{class:"withdraw-password"},{default:r(()=>[D(e(a(J),null,{default:r(()=>[e(a(G),{lines:"none"},{default:r(()=>[m.value?(V(),v(a(c),{key:0,style:{margin:"32px 0"}},{default:r(()=>[e(a(u),{modelValue:t.withdrawPasswordOri,"onUpdate:modelValue":o[0]||(o[0]=n=>t.withdrawPasswordOri=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.originalPassword")},{default:r(()=>[e(a(P),{slot:"start",icon:a(b)},null,8,["icon"]),e(a(g),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1})):S("",!0),e(a(c),{style:{margin:"8px 0"}},{default:r(()=>[e(a(u),{modelValue:t.withdrawPassword,"onUpdate:modelValue":o[1]||(o[1]=n=>t.withdrawPassword=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.password")},{default:r(()=>[e(a(P),{slot:"start",icon:a(b)},null,8,["icon"]),e(a(g),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1}),e(a(c),{style:{margin:"8px 0 16px 0"}},{default:r(()=>[e(a(u),{modelValue:t.withdrawPasswordRepeat,"onUpdate:modelValue":o[2]||(o[2]=n=>t.withdrawPasswordRepeat=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.repeatPassword")},{default:r(()=>[e(a(P),{slot:"start",icon:a(b)},null,8,["icon"]),e(a(g),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1}),e(a(c),{style:{margin:"16px 0 8px 0"}},{default:r(()=>[e(a(u),{modelValue:t.mobile,"onUpdate:modelValue":o[3]||(o[3]=n=>t.mobile=n),fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.phone")},{default:r(()=>[_("span",F,"+"+k(a(I)),1)]),_:1},8,["modelValue","placeholder"])]),_:1}),e(a(c),{style:{margin:"8px 0"}},{default:r(()=>[e(a(u),{modelValue:t.code,"onUpdate:modelValue":o[4]||(o[4]=n=>t.code=n),fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.otpPlaceholder")},{default:r(()=>[H,e(a(C),{slot:"end",class:"btn-otp",color:"medium",style:{color:"#00ff84"},onClick:R},{default:r(()=>[x(k(p.value),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1}),e(a(C),{class:"btn-confirm",expand:"block",shape:"round",onClick:N},{default:r(()=>[x("Confirm")]),_:1})]),_:1},512),[[L,!a(l).barLoading]])]),_:1}))}};export{Pt as default};
