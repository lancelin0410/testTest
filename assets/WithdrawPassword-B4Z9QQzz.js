import{k as $,r as f,I,J as r,G as a,K as V,b as N,L as S,D as o,Y as D,M as C,P as k,R as x}from"./@vue-3Wdfxk3_.js";import{u as T}from"./vue-i18n-BmGSZPWT.js";import{o as U,u as W,y as E,z as c,E as u,k as P,P as g,l as _,v as G,p as M,t as w}from"./@ionic-ChxHNRcu.js";import{n as b,x as q}from"./ionicons-DCtDYcIg.js";import{u as z,k as A,f as J}from"./index-BtfuBToB.js";import{f as K,h as Y}from"./withdraw-DCpFKFrH.js";import"./@intlify-BAcCFw_v.js";import"./@ionic_components_1-CAQXnsIn.js";import"./@stencil-C-gE1UvY.js";import"./@ionic_components_2-DUGZJZYA.js";import"./@capacitor-CHoHO2YB.js";import"./vue-router-CvOicv45.js";import"./localforage-qzmIiYbH.js";import"./@adjustcom-Dev-Q0DI.js";import"./pinia-i8UTD9O9.js";import"./jsencrypt-Ve0Y4aUG.js";import"./pinia-plugin-persistedstate-2-DcGv4gw_.js";import"./@awesome-cordova-plugins-CT7d7gQP.js";import"./rxjs-C3tg6S9t.js";import"./tslib-BHBn2Msb.js";const j={slot:"start"},F=C("span",{slot:"start"},"OTP",-1),Pt={__name:"WithdrawPassword",setup(H){const{t:i}=T(),O=W(),l=z(),t=$({withdrawPasswordOri:"",withdrawPassword:"",withdrawPasswordRepeat:"",mobile:"",code:"",sessionId:""});let y;const v=Number(l.appConfig.callPrefixes),d=f(0),p=f(i("account.button.otp")),m=f(!1),h=f(!1);U(async()=>{l.barLoading=!0;const s=await A();s.code==="00000"&&(m.value=!!s.data.withdrawPasswordValid,h.value=!!s.data.phoneValid),l.barLoading=!1});const R=async()=>{if(d.value==0){if(!t.mobile||t.mobile.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.phone"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}const s=await J({mobile:l.encrypt.encrypt(t.mobile),callPrefixes:v});s.code==="00000"&&(t.sessionId=s.data.sessionId,d.value=60,B())}},B=()=>{p.value="".concat(d.value,"s"),y=setInterval(()=>{d.value>0?(d.value--,p.value="".concat(d.value,"s")):(p.value=i("account.button.otp"),d.value=0,clearInterval(y))},1e3)},L=async()=>{if(m.value&&(!t.withdrawPasswordOri||t.withdrawPasswordOri.length==0)){await(await w.create({message:i("account.withdrawalPassword.toast.withdrawPasswdOri"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!t.withdrawPassword||t.withdrawPassword.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.withdrawPasswd"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(t.withdrawPassword!==t.withdrawPasswordRepeat){await(await w.create({message:i("account.withdrawalPassword.toast.withdrawPasswdRepeat"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!t.mobile||t.mobile.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.phone"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!t.code||t.code.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.verificationCode"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}l.fullLoading=!0;let s;m.value?s=await K({oldPassword:l.encrypt.encrypt(t.withdrawPasswordOri),password:l.encrypt.encrypt(t.withdrawPassword),confirmPassword:l.encrypt.encrypt(t.withdrawPasswordRepeat),mobile:h.value?"":l.encrypt.encrypt(t.mobile),code:t.code,sessionId:t.sessionId}):s=await Y({password:l.encrypt.encrypt(t.withdrawPassword),confirmPassword:l.encrypt.encrypt(t.withdrawPasswordRepeat),mobile:h.value?"":l.encrypt.encrypt(t.mobile),code:t.code,sessionId:t.sessionId}),s.code==="00000"&&(await(await w.create({message:"Success",duration:1500,position:"top",translucent:!0,icon:q,color:"success"})).present(),setTimeout(()=>O.back(),1e3)),l.fullLoading=!1};return(s,e)=>(V(),I(a(M),{class:"withdraw-password"},{default:r(()=>[N(o(a(G),null,{default:r(()=>[o(a(E),{lines:"none"},{default:r(()=>[m.value?(V(),I(a(c),{key:0,style:{margin:"32px 0"}},{default:r(()=>[o(a(u),{modelValue:t.withdrawPasswordOri,"onUpdate:modelValue":e[0]||(e[0]=n=>t.withdrawPasswordOri=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.originalPassword")},{default:r(()=>[o(a(P),{slot:"start",icon:a(b)},null,8,["icon"]),o(a(g),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1})):D("",!0),o(a(c),{style:{margin:"8px 0"}},{default:r(()=>[o(a(u),{modelValue:t.withdrawPassword,"onUpdate:modelValue":e[1]||(e[1]=n=>t.withdrawPassword=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.password")},{default:r(()=>[o(a(P),{slot:"start",icon:a(b)},null,8,["icon"]),o(a(g),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1}),o(a(c),{style:{margin:"8px 0 16px 0"}},{default:r(()=>[o(a(u),{modelValue:t.withdrawPasswordRepeat,"onUpdate:modelValue":e[2]||(e[2]=n=>t.withdrawPasswordRepeat=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.repeatPassword")},{default:r(()=>[o(a(P),{slot:"start",icon:a(b)},null,8,["icon"]),o(a(g),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1}),o(a(c),{style:{margin:"16px 0 8px 0"}},{default:r(()=>[o(a(u),{modelValue:t.mobile,"onUpdate:modelValue":e[3]||(e[3]=n=>t.mobile=n),fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.phone")},{default:r(()=>[C("span",j,"+"+k(a(v)),1)]),_:1},8,["modelValue","placeholder"])]),_:1}),o(a(c),{style:{margin:"8px 0"}},{default:r(()=>[o(a(u),{modelValue:t.code,"onUpdate:modelValue":e[4]||(e[4]=n=>t.code=n),fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.otpPlaceholder")},{default:r(()=>[F,o(a(_),{slot:"end",class:"btn-otp",color:"medium",style:{color:"#00ff84"},onClick:R},{default:r(()=>[x(k(p.value),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1}),o(a(_),{class:"btn-confirm",expand:"block",shape:"round",onClick:L},{default:r(()=>[x("Confirm")]),_:1})]),_:1},512),[[S,!a(l).barLoading]])]),_:1}))}};export{Pt as default};
