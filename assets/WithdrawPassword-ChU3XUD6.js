import{u as N}from"./vue-i18n-DzMZFiEd.js";import{K as $,u as S,o as T,D as c,N as u,f,T as h,g as v,E as U,k as D,t as w}from"./@ionic-18nICBu3.js";import{n as P,x as W}from"./ionicons-CdrslGsx.js";import{u as E,m as M,i as j}from"./index-CBAZMc4h.js";import{f as q,h as A}from"./withdraw-k7JEOECy.js";import{j as G,r as g,c as H,I as b,J as r,E as a,H as y,C as o,S as k,L as O,M as x,O as C}from"./@vue-B0j_qcai.js";import"./@intlify-BAcCFw_v.js";import"./@stencil-DBaMOtEh.js";import"./@capacitor-CHoHO2YB.js";import"./vue-router-BLYQmdkJ.js";import"./localforage-qzmIiYbH.js";import"./@adjustcom-Dev-Q0DI.js";import"./pinia-Ds326xZN.js";import"./jsencrypt-Ve0Y4aUG.js";import"./pinia-plugin-persistedstate-2-DcGv4gw_.js";import"./@awesome-cordova-plugins-CT7d7gQP.js";import"./rxjs-C3tg6S9t.js";import"./tslib-BHBn2Msb.js";const J={slot:"start"},K=O("span",{slot:"start"},"OTP",-1),pt={__name:"WithdrawPassword",setup(z){const{t:i}=N(),_=S(),l=E(),t=G({withdrawPasswordOri:"",withdrawPassword:"",withdrawPasswordRepeat:"",mobile:"",code:"",sessionId:""});let I;const V=Number(l.appConfig.callPrefixes),d=g(0),p=g(i("account.button.otp")),m=g(!1);H(()=>!!t.mobile),$(async()=>{l.barLoading=!0;const s=await M();s.code==="00000"&&(m.value=!!s.data.withdrawPasswordValid),l.barLoading=!1});const R=async()=>{if(d.value==0){if(!t.mobile||t.mobile.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.phone"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}const s=await j({mobile:l.encrypt.encrypt(t.mobile),callPrefixes:V});s.code==="00000"&&(t.sessionId=s.data.sessionId,d.value=60,B())}},B=()=>{p.value="".concat(d.value,"s"),I=setInterval(()=>{d.value>0?(d.value--,p.value="".concat(d.value,"s")):(p.value=i("account.button.otp"),d.value=0,clearInterval(I))},1e3)},L=async()=>{if(m.value&&(!t.withdrawPasswordOri||t.withdrawPasswordOri.length==0)){await(await w.create({message:i("account.withdrawalPassword.toast.withdrawPasswdOri"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!t.withdrawPassword||t.withdrawPassword.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.withdrawPasswd"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(t.withdrawPassword!==t.withdrawPasswordRepeat){await(await w.create({message:i("account.withdrawalPassword.toast.withdrawPasswdRepeat"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!t.mobile||t.mobile.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.phone"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}if(!t.code||t.code.length==0){await(await w.create({message:i("account.withdrawalPassword.toast.verificationCode"),duration:1500,position:"top",color:"warning",translucent:!0})).present();return}l.fullLoading=!0;let s;m.value?s=await q({oldPassword:l.encrypt.encrypt(t.withdrawPasswordOri),password:l.encrypt.encrypt(t.withdrawPassword),confirmPassword:l.encrypt.encrypt(t.withdrawPasswordRepeat),code:t.code,sessionId:t.sessionId}):s=await A({password:l.encrypt.encrypt(t.withdrawPassword),confirmPassword:l.encrypt.encrypt(t.withdrawPasswordRepeat),code:t.code,sessionId:t.sessionId}),s.code==="00000"&&(await(await w.create({message:"Success",duration:1500,position:"top",translucent:!0,icon:W,color:"success"})).present(),setTimeout(()=>_.back(),1e3)),l.fullLoading=!1};return(s,e)=>(y(),b(a(D),{class:"withdraw-password"},{default:r(()=>[a(l).barLoading?k("",!0):(y(),b(a(T),{key:0},{default:r(()=>[o(a(U),{lines:"none"},{default:r(()=>[m.value?(y(),b(a(c),{key:0,style:{margin:"32px 0"}},{default:r(()=>[o(a(u),{modelValue:t.withdrawPasswordOri,"onUpdate:modelValue":e[0]||(e[0]=n=>t.withdrawPasswordOri=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.originalPassword")},{default:r(()=>[o(a(f),{slot:"start",icon:a(P)},null,8,["icon"]),o(a(h),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1})):k("",!0),o(a(c),{style:{margin:"8px 0"}},{default:r(()=>[o(a(u),{modelValue:t.withdrawPassword,"onUpdate:modelValue":e[1]||(e[1]=n=>t.withdrawPassword=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.password")},{default:r(()=>[o(a(f),{slot:"start",icon:a(P)},null,8,["icon"]),o(a(h),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1}),o(a(c),{style:{margin:"8px 0 16px 0"}},{default:r(()=>[o(a(u),{modelValue:t.withdrawPasswordRepeat,"onUpdate:modelValue":e[2]||(e[2]=n=>t.withdrawPasswordRepeat=n),type:"password",fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.repeatPassword")},{default:r(()=>[o(a(f),{slot:"start",icon:a(P)},null,8,["icon"]),o(a(h),{slot:"end",color:"medium"})]),_:1},8,["modelValue","placeholder"])]),_:1}),o(a(c),{style:{margin:"16px 0 8px 0"}},{default:r(()=>[o(a(u),{modelValue:t.mobile,"onUpdate:modelValue":e[3]||(e[3]=n=>t.mobile=n),fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.phone")},{default:r(()=>[O("span",J,"+"+x(a(V)),1)]),_:1},8,["modelValue","placeholder"])]),_:1}),o(a(c),{style:{margin:"8px 0"}},{default:r(()=>[o(a(u),{modelValue:t.code,"onUpdate:modelValue":e[4]||(e[4]=n=>t.code=n),fill:"outline",placeholder:s.$t("account.withdrawalPassword.label.otpPlaceholder")},{default:r(()=>[K,o(a(v),{slot:"end",class:"btn-otp",color:"medium",style:{color:"#00ff84"},onClick:R},{default:r(()=>[C(x(p.value),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1}),o(a(v),{class:"btn-confirm",expand:"block",shape:"round",onClick:L},{default:r(()=>[C("Confirm")]),_:1})]),_:1}))]),_:1}))}};export{pt as default};
