import{Z as y,aB as $,r as k,m as P,l as q,X as F,j as w,w as s,u as e,d as m,ak as G,al as H,f as o,T as J,U as S,B as z,M as K,e as B,i as D,F as T,a1 as _,z as O,A as R,H as V,L as x,h as d,y as f,aC as A,q as v,s as g,v as N,K as L,J as I,af as U,ag as E,C as W}from"./index-BWYPlUKf.js";import{_ as X}from"./NoData-DERR8tLK.js";function Z(l){return y({url:"/app/member/h5/siteMsg",method:"GET",params:l})}function Q(l){return y({url:"/app/member/h5/siteMsg/read",method:"POST",data:l})}function Y(l){return y({url:"/app/member/h5/siteMsg/del",method:"PUT",data:l})}function ee(l){return y({url:"/app/member/h5/announce",method:"GET",params:l})}const te=$("mail",()=>{const l=k([]),n=k([]),r=P(()=>l.value.some(c=>!c.readStatus));return{mailList:l,hasUnread:r,getMailList:async()=>{const c=await Z();c.code==="00000"&&(l.value=c.data.list||[],l.value.forEach(h=>h.showDetail=!1))},announceList:n,getAnnounceList:async()=>{const c=await ee();c.code==="00000"&&(n.value=c.data.list||[],n.value.forEach(h=>h.showDetail=!1))}}},{persistedState:{persist:!1}}),ae={style:{"font-size":"0.8rem"}},se={style:{"font-size":"1rem","font-weight":"800"}},oe={style:{"font-size":"0.8rem"}},le={style:{"font-size":"1rem","font-weight":"800"}},re={__name:"Mail",setup(l){const n=q(),r=te(),{getPublicUrl:b}=W(),i=k("system"),c={system:"mailList",activities:"announceList"};F(async()=>{n.barLoading=!0,await r.getMailList(),n.barLoading=!1});const h=async()=>{i.value=="system"&&await r.getMailList(),i.value=="activities"&&await r.getAnnounceList()},C=async u=>{u.showDetail=!u.showDetail,mail.readStatus||(i.value=="system"&&Q({id:u.detailId}),i.value=="activities"&&readAnnounce({id:u.mainId}))},j=async u=>{n.barLoading=!0;const p=await Y({mailId:u.detailId});p.code==="00000"?(await r.getMailList(),n.barLoading=!1,await(await toastController.create({message:t("mail.message.deleteSuccess"),duration:1500,position:"top",color:"success",translucent:!0})).present()):(await(await toastController.create({message:p.msg,duration:1500,position:"top",color:"danger",translucent:!0})).present(),n.barLoading=!1)};return(u,p)=>(m(),w(e(R),{class:"mail"},{default:s(()=>[G(o(e(O),null,{default:s(()=>[o(e(J),{modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=a=>i.value=a),mode:"ios",onIonChange:h},{default:s(()=>[o(e(S),{value:"system"},{default:s(()=>[z("System Notices")]),_:1}),o(e(S),{value:"activities"},{default:s(()=>[z("Activities")]),_:1})]),_:1},8,["modelValue"]),e(n).barLoading||e(r)[c[i.value]].length==0?(m(),w(X,{key:0,class:"no-data",desc:u.$t("mail.message.nodata")},null,8,["desc"])):(m(),w(e(K),{key:1,style:{"margin-top":"16px"}},{default:s(()=>[i.value=="system"?(m(!0),B(T,{key:0},D(e(r).mailList,a=>(m(),w(e(V),{key:a.detailId,class:"mail-item",lines:"none"},{default:s(()=>[o(e(x),{class:"mail-content"},{default:s(()=>[d("div",ae,f(a.gmtCreate||""),1),d("h4",se,f(a.msgTitle||""),1),d("div",{class:A(["mail-detail",{"show-all":a.showDetail}])},f(a.msgContent||""),3),o(e(v),{class:"ion-justify-content-end"},{default:s(()=>[o(e(g),{size:"auto"},{default:s(()=>[o(e(N),{class:"btn-show-all",color:"light",fill:"clear",size:"small",onClick:L(M=>C(a),["stop"])},{default:s(()=>[d("span",null,f(a.showDetail?"hide":"Show all"),1),o(e(I),{icon:a.showDetail?e(U):e(E),style:{"margin-left":"4px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),o(e(v),{class:"ion-align-items-center ion-justify-content-between"},{default:s(()=>[o(e(g),{size:"auto"},{default:s(()=>[_("",!0)]),_:1}),o(e(g),{size:"auto"},{default:s(()=>[o(e(I),{class:"btn-del",src:e(b)("/icon_userInfo/icon-delete.svg"),onClick:L(M=>j(a),["stop"])},null,8,["src","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)):_("",!0),i.value=="activities"?(m(!0),B(T,{key:1},D(e(r).announceList,a=>(m(),w(e(V),{key:a.mainId,class:"mail-item",lines:"none"},{default:s(()=>[o(e(x),{class:"mail-content"},{default:s(()=>[d("div",oe,f(a.startTime||""),1),d("h4",le,f(a.title||""),1),d("div",{class:A(["mail-detail",{"show-all":a.showDetail}])},f(a.content||""),3),o(e(v),{class:"ion-justify-content-end"},{default:s(()=>[o(e(g),{size:"auto"},{default:s(()=>[o(e(N),{class:"btn-show-all",color:"light",fill:"clear",size:"small",onClick:L(M=>C(a),["stop"])},{default:s(()=>[d("span",null,f(a.showDetail?"hide":"Show all"),1),o(e(I),{icon:u.mail.showDetail?e(U):e(E),style:{"margin-left":"4px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),o(e(v),{class:"ion-align-items-center ion-justify-content-between"},{default:s(()=>[o(e(g),{size:"auto"},{default:s(()=>[_("",!0)]),_:1}),o(e(g),{size:"auto"})]),_:1})]),_:2},1024)]),_:2},1024))),128)):_("",!0)]),_:1}))]),_:1},512),[[H,!e(n).barLoading]])]),_:1}))}};export{re as default};
